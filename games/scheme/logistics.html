<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥–∏—Å—Ç–∏–∫–∞ ‚Ä¢ –ì–∏–ø–Ω–æ–§–∏–ª–∏–Ω</title>
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon.png">
    <link rel="stylesheet" href="../../global.css">
    <link rel="stylesheet" href="../../navbar.css">
    <style>
        .logistics-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .page-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            margin-bottom: 40px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* –ü–∞–Ω–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .categories-panel {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            height: fit-content;
        }

        .category-block {
            margin-bottom: 30px;
        }

        .category-block:last-child {
            margin-bottom: 0;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .category-emoji {
            font-size: 20px;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .add-place-btn {
            width: 100%;
            background: linear-gradient(135deg, #0a84ff 0%, #0066cc 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
        }

        .add-place-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
        }

        .places-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 300px;
            overflow-y: auto;
        }

        .place-item {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .place-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }

        .place-item.selected {
            background: linear-gradient(135deg, rgba(10, 132, 255, 0.2) 0%, rgba(0, 102, 204, 0.2) 100%);
            border-color: rgba(10, 132, 255, 0.4);
        }

        .place-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .place-rating {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-left: 8px;
        }

        .remove-place-btn {
            color: rgba(255, 255, 255, 0.4);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0 4px;
            margin-left: 8px;
            transition: color 0.2s ease;
        }

        .remove-place-btn:hover {
            color: rgba(255, 100, 100, 0.9);
        }

        /* –ö–∞—Ä—Ç–∞ */
        .map-container {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            min-height: 600px;
            position: relative;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-title {
            font-size: 18px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .map-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 8px;
            padding: 8px 16px;
            color: rgba(255, 255, 255, 0.85);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #0a84ff 0%, #0066cc 100%);
            color: white;
            border: none;
        }

        .canvas-wrapper {
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            overflow: hidden;
        }

        #mapCanvas {
            display: block;
            width: 100%;
            height: 550px;
            cursor: grab;
        }

        #mapCanvas:active {
            cursor: grabbing;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.65);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: rgba(13, 13, 16, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 8px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.55);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.85);
        }

        .form-input, .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 14px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.95);
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #0a84ff;
            background: rgba(255, 255, 255, 0.08);
        }

        .rating-group {
            margin-bottom: 20px;
        }

        .rating-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.85);
        }

        .rating-scale {
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }

        .rating-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 8px;
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .rating-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .rating-btn.active {
            background: linear-gradient(135deg, #0a84ff 0%, #0066cc 100%);
            border-color: #0a84ff;
            color: white;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .modal-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .modal-btn-submit {
            background: linear-gradient(135deg, #0a84ff 0%, #0066cc 100%);
            color: white;
        }

        .modal-btn-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .info-panel {
            position: absolute;
            top: 80px;
            right: 24px;
            background: rgba(13, 13, 16, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            max-width: 280px;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-panel.show {
            display: block;
        }

        .info-title {
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 12px;
        }

        .info-criteria {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-criterion {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .info-criterion-name {
            color: rgba(255, 255, 255, 0.65);
        }

        .info-criterion-value {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 600;
        }

        .info-stars {
            color: #0a84ff;
        }

        .info-description {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.55);
            line-height: 1.5;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .categories-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }

            .category-block {
                margin-bottom: 0;
            }

            .info-panel {
                position: fixed;
                bottom: 0;
                right: 0;
                left: 0;
                top: auto;
                max-width: 100%;
                border-radius: 16px 16px 0 0;
            }
        }

        @media (max-width: 768px) {
            .categories-panel {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 28px;
            }

            .logistics-container {
                padding: 20px 15px;
            }

            #mapCanvas {
                height: 400px;
            }

            .map-controls {
                flex-direction: column;
            }

            .control-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar center-menu">
        <div class="container">
            <ul class="nav-menu">
                <li><a href="../../index.html" class="nav-link" data-page="index">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="../../courses.html" class="nav-link" data-page="courses">–ö—É—Ä—Å—ã</a></li>
                <li><a href="../../games.html" class="nav-link" data-page="games">–ò–≥—Ä—ã</a></li>
                <li><a href="../../about.html" class="nav-link" data-page="about">–û–±–æ –º–Ω–µ</a></li>
            </ul>
        </div>
    </nav>

    <div class="logistics-container">
        <h1 class="page-title">–ö–∞—Ä—Ç–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏</h1>
        <p class="page-subtitle">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –º–∞—Ä—à—Ä—É—Ç: –æ—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –¥–æ —Ñ–∏–Ω–∞–ª–∞</p>

        <div class="main-layout">
            <!-- –ü–∞–Ω–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="categories-panel">
                <!-- –ú–µ—Å—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ -->
                <div class="category-block">
                    <div class="category-header">
                        <span class="category-emoji">üëã</span>
                        <h3 class="category-title">–ú–µ—Å—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞</h3>
                    </div>
                    <button class="add-place-btn" onclick="openAddModal('meet')">+ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</button>
                    <div class="places-list" id="meetPlaces"></div>
                </div>

                <!-- –ú–µ—Å—Ç–∞ –æ–±—â–µ–Ω–∏—è -->
                <div class="category-block">
                    <div class="category-header">
                        <span class="category-emoji">üí¨</span>
                        <h3 class="category-title">–ú–µ—Å—Ç–∞ –æ–±—â–µ–Ω–∏—è</h3>
                    </div>
                    <button class="add-place-btn" onclick="openAddModal('talk')">+ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</button>
                    <div class="places-list" id="talkPlaces"></div>
                </div>

                <!-- –ú–µ—Å—Ç–∞ —Å–µ–∫—Å–∞ -->
                <div class="category-block">
                    <div class="category-header">
                        <span class="category-emoji">üî•</span>
                        <h3 class="category-title">–ú–µ—Å—Ç–∞ —Å–µ–∫—Å–∞</h3>
                    </div>
                    <button class="add-place-btn" onclick="openAddModal('sex')">+ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</button>
                    <div class="places-list" id="sexPlaces"></div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="map-container">
                <div class="map-header">
                    <h2 class="map-title">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</h2>
                    <div class="map-controls">
                        <button class="control-btn" onclick="clearRoute()">–û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
                        <button class="control-btn primary" onclick="buildRoute()">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
                    </div>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="mapCanvas"></canvas>
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                    <div class="info-panel" id="infoPanel"></div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50;"></div>
                        <span>–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2196F3;"></div>
                        <span>–û–±—â–µ–Ω–∏–µ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF5722;"></div>
                        <span>–°–µ–∫—Å</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞ -->
    <div class="modal-overlay" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</h2>
                <p class="modal-subtitle" id="modalSubtitle"></p>
            </div>

            <form id="addPlaceForm">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ *</label>
                    <input type="text" class="form-input" id="placeName" required maxlength="30" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–æ–ª—å—à–∞—è –ü–æ–∫—Ä–æ–≤—Å–∫–∞—è">
                </div>

                <div id="criteriaContainer"></div>

                <div class="modal-actions">
                    <button type="button" class="modal-btn modal-btn-cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="modal-btn modal-btn-submit">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // === –ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ===
        const criteria = {
            meet: [
                { id: 'capacity', label: '–Å–º–∫–æ—Å—Ç—å', description: '–°–∫–æ–ª—å–∫–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ª—é–¥–µ–π' },
                { id: 'openness', label: '–õ—ë–≥–∫–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏—è', description: '–ù–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä' },
                { id: 'context', label: '–ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—â–µ–Ω–∏—è', description: '–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ–Ω—è—Ç–Ω–æ, –æ —á—ë–º –≥–æ–≤–æ—Ä–∏—Ç—å' }
            ],
            talk: [
                { id: 'atmosphere', label: '–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞', description: '–ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ/—É—é—Ç–Ω–æ' },
                { id: 'activity', label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', description: '–ß—Ç–æ —Ç–∞–º –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å' },
                { id: 'price', label: '–°—Ä–µ–¥–Ω–∏–π —á–µ–∫', description: '–°–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ —É–π–¥—ë—Ç' }
            ],
            sex: [
                { id: 'privacy', label: '–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å', description: '–ù–∞—Å–∫–æ–ª—å–∫–æ –Ω–µ —Å–ø–∞–ª—è—Ç' },
                { id: 'comfort', label: '–ö–æ–º—Ñ–æ—Ä—Ç', description: '–ï—Å—Ç—å –ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è' },
                { id: 'availability', label: '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å', description: '–õ–µ–≥–∫–æ –ª–∏ —Ç—É–¥–∞ –ø–æ–ø–∞—Å—Ç—å –±—ã—Å—Ç—Ä–æ' }
            ]
        };

        // === –î–∞–Ω–Ω—ã–µ ===
        // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        const defaultPlaces = {
            meet: [
                {
                    name: '–ë–æ–ª—å—à–∞—è –ü–æ–∫—Ä–æ–≤—Å–∫–∞—è',
                    x: 150,
                    y: 100,
                    ratings: { capacity: 4, openness: 3, context: 4 },
                    description: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —É–ª–∏—Ü–∞, –º–Ω–æ–≥–æ –ª—é–¥–µ–π'
                },
                {
                    name: '–ü–∞—Ä–∫ –®–≤–µ–π—Ü–∞—Ä–∏—è',
                    x: 200,
                    y: 150,
                    ratings: { capacity: 3, openness: 4, context: 5 },
                    description: '–°–ø–æ–∫–æ–π–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫'
                }
            ],
            talk: [
                {
                    name: '–ë–∞—Ä –ö–æ–π–æ—Ç',
                    x: 400,
                    y: 200,
                    ratings: { atmosphere: 4, activity: 3, price: 3 },
                    description: '–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞, —Ç–∞–Ω—Ü—ã',
                    averageCheck: 2000
                },
                {
                    name: '–ë–∞—Ä –ò—Å–∫—Ä—ã',
                    x: 450,
                    y: 250,
                    ratings: { atmosphere: 5, activity: 2, price: 4 },
                    description: '–£—é—Ç–Ω—ã–π –±–∞—Ä –¥–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤',
                    averageCheck: 3000
                }
            ],
            sex: [
                {
                    name: '–î–æ–º–∞',
                    x: 700,
                    y: 300,
                    ratings: { privacy: 5, comfort: 5, availability: 4 },
                    description: '–ö–ª–∞—Å—Å–∏–∫–∞'
                }
            ]
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö
        function loadPlaces() {
            const saved = localStorage.getItem('logistics-places');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                    return JSON.parse(JSON.stringify(defaultPlaces));
                }
            }
            return JSON.parse(JSON.stringify(defaultPlaces));
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function savePlaces() {
            try {
                localStorage.setItem('logistics-places', JSON.stringify(places));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', e);
            }
        }

        const places = loadPlaces();

        const selectedPlaces = {
            meet: null,
            talk: null,
            sex: null
        };

        const colors = {
            meet: '#4CAF50',
            talk: '#2196F3',
            sex: '#FF5722'
        };

        let currentCategory = null;
        let draggedPoint = null;
        let hoveredPoint = null;
        let canvas, ctx;

        // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
        window.addEventListener('load', () => {
            canvas = document.getElementById('mapCanvas');
            ctx = canvas.getContext('2d');

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            renderPlacesLists();
            drawMap();

            // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('click', handleClick);

            // –°–æ–±—ã—Ç–∏—è —Ç–∞—á
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);

            // –§–æ—Ä–º–∞
            document.getElementById('addPlaceForm').addEventListener('submit', handleFormSubmit);
        });

        function resizeCanvas() {
            const wrapper = canvas.parentElement;
            canvas.width = wrapper.offsetWidth;
            canvas.height = 550;
            drawMap();
        }

        // === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ===
        function openAddModal(category) {
            currentCategory = category;
            const modal = document.getElementById('addModal');
            const title = document.getElementById('modalTitle');
            const subtitle = document.getElementById('modalSubtitle');
            const criteriaContainer = document.getElementById('criteriaContainer');

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            const titles = {
                meet: '–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞',
                talk: '–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –æ–±—â–µ–Ω–∏—è',
                sex: '–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ —Å–µ–∫—Å–∞'
            };
            title.textContent = titles[category];
            subtitle.textContent = '–û—Ü–µ–Ω–∏—Ç–µ –º–µ—Å—Ç–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –æ—Ç 1 –¥–æ 5';

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('placeName').value = '';
            criteriaContainer.innerHTML = '';

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
            criteria[category].forEach(criterion => {
                const ratingGroup = document.createElement('div');
                ratingGroup.className = 'rating-group';

                const label = document.createElement('label');
                label.className = 'rating-label';
                label.textContent = `${criterion.label} ‚Äî ${criterion.description}`;

                const scale = document.createElement('div');
                scale.className = 'rating-scale';

                for (let i = 1; i <= 5; i++) {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'rating-btn';
                    btn.textContent = i;
                    btn.dataset.criterion = criterion.id;
                    btn.dataset.value = i;
                    btn.onclick = () => selectRating(criterion.id, i);
                    scale.appendChild(btn);
                }

                ratingGroup.appendChild(label);
                ratingGroup.appendChild(scale);
                criteriaContainer.appendChild(ratingGroup);
            });

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (category === 'meet' || category === 'talk') {
                const descGroup = document.createElement('div');
                descGroup.className = 'form-group';
                descGroup.innerHTML = `
                    <label class="form-label">${category === 'meet' ? '–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞' : '–ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å'}</label>
                    <textarea class="form-textarea" id="placeDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ${category === 'meet' ? '–õ—é–¥–∏ –≥—É–ª—è—é—Ç —Å —Å–æ–±–∞–∫–∞–º–∏' : '–ì—É–ª—è—Ç—å, —Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞—Ç'}"></textarea>
                `;
                criteriaContainer.appendChild(descGroup);
            }

            if (category === 'talk') {
                const priceGroup = document.createElement('div');
                priceGroup.className = 'form-group';
                priceGroup.innerHTML = `
                    <label class="form-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ (‚ÇΩ)</label>
                    <input type="number" class="form-input" id="averageCheck" placeholder="2000" min="0" step="100">
                `;
                criteriaContainer.appendChild(priceGroup);
            }

            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        function selectRating(criterionId, value) {
            const buttons = document.querySelectorAll(`[data-criterion="${criterionId}"]`);
            buttons.forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.value) === value);
            });
        }

        function handleFormSubmit(e) {
            e.preventDefault();

            const name = document.getElementById('placeName').value.trim();
            if (!name) return;

            // –°–æ–±–∏—Ä–∞–µ–º –æ—Ü–µ–Ω–∫–∏
            const ratings = {};
            criteria[currentCategory].forEach(criterion => {
                const activeBtn = document.querySelector(`[data-criterion="${criterion.id}"].active`);
                ratings[criterion.id] = activeBtn ? parseInt(activeBtn.dataset.value) : 3;
            });

            // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let x, y;
            if (currentCategory === 'meet') {
                x = 100 + Math.random() * 200;
                y = 100 + Math.random() * 200;
            } else if (currentCategory === 'talk') {
                x = 350 + Math.random() * 200;
                y = 150 + Math.random() * 200;
            } else {
                x = 600 + Math.random() * 150;
                y = 200 + Math.random() * 200;
            }

            const place = { name, x, y, ratings };

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const descField = document.getElementById('placeDescription');
            if (descField) {
                place.description = descField.value.trim();
            }

            const checkField = document.getElementById('averageCheck');
            if (checkField) {
                place.averageCheck = parseInt(checkField.value) || 0;
            }

            places[currentCategory].push(place);

            savePlaces();
            closeModal();
            renderPlacesLists();
            drawMap();
        }

        // === –†–∞–±–æ—Ç–∞ —Å –º–µ—Å—Ç–∞–º–∏ ===
        function removePlace(category, index) {
            places[category].splice(index, 1);
            if (selectedPlaces[category] && selectedPlaces[category].index === index) {
                selectedPlaces[category] = null;
            }
            savePlaces();
            renderPlacesLists();
            drawMap();
        }

        function selectPlace(category, index) {
            selectedPlaces[category] = { index, place: places[category][index] };
            renderPlacesLists();
            drawMap();
        }

        function renderPlacesLists() {
            ['meet', 'talk', 'sex'].forEach(category => {
                const container = document.getElementById(category + 'Places');
                container.innerHTML = '';

                places[category].forEach((place, index) => {
                    const item = document.createElement('div');
                    item.className = 'place-item';
                    if (selectedPlaces[category] && selectedPlaces[category].index === index) {
                        item.classList.add('selected');
                    }

                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'place-name';
                    nameSpan.textContent = place.name;

                    // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
                    const avgRating = Object.values(place.ratings).reduce((a, b) => a + b, 0) / Object.values(place.ratings).length;
                    const ratingSpan = document.createElement('span');
                    ratingSpan.className = 'place-rating';
                    ratingSpan.textContent = '‚òÖ'.repeat(Math.round(avgRating));

                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-place-btn';
                    removeBtn.innerHTML = '√ó';
                    removeBtn.onclick = (e) => {
                        e.stopPropagation();
                        removePlace(category, index);
                    };

                    item.appendChild(nameSpan);
                    item.appendChild(ratingSpan);
                    item.appendChild(removeBtn);
                    item.onclick = () => selectPlace(category, index);

                    container.appendChild(item);
                });
            });
        }

        // === –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã ===
        function drawMap() {
            if (!ctx) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRoute();
            drawPoints();
        }

        function drawRoute() {
            const route = [];
            ['meet', 'talk', 'sex'].forEach(category => {
                if (selectedPlaces[category]) {
                    route.push({
                        category,
                        place: selectedPlaces[category].place
                    });
                }
            });

            if (route.length < 2) return;

            ctx.strokeStyle = 'rgba(10, 132, 255, 0.6)';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);

            ctx.beginPath();
            ctx.moveTo(route[0].place.x, route[0].place.y);

            for (let i = 1; i < route.length; i++) {
                ctx.lineTo(route[i].place.x, route[i].place.y);
            }

            ctx.stroke();
            ctx.setLineDash([]);

            for (let i = 1; i < route.length; i++) {
                drawArrow(
                    route[i - 1].place.x,
                    route[i - 1].place.y,
                    route[i].place.x,
                    route[i].place.y
                );
            }
        }

        function drawArrow(x1, y1, x2, y2) {
            const angle = Math.atan2(y2 - y1, x2 - x1);
            const arrowSize = 12;
            const mx = (x1 + x2) / 2;
            const my = (y1 + y2) / 2;

            ctx.fillStyle = 'rgba(10, 132, 255, 0.8)';
            ctx.beginPath();
            ctx.moveTo(mx, my);
            ctx.lineTo(
                mx - arrowSize * Math.cos(angle - Math.PI / 6),
                my - arrowSize * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                mx - arrowSize * Math.cos(angle + Math.PI / 6),
                my - arrowSize * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fill();
        }

        function drawPoints() {
            ['meet', 'talk', 'sex'].forEach(category => {
                places[category].forEach((place, index) => {
                    const isSelected = selectedPlaces[category] && selectedPlaces[category].index === index;
                    const isHovered = hoveredPoint && hoveredPoint.category === category && hoveredPoint.index === index;
                    const radius = isSelected ? 14 : (isHovered ? 12 : 10);

                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 8;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 2;

                    ctx.fillStyle = colors[category];
                    ctx.beginPath();
                    ctx.arc(place.x, place.y, radius, 0, Math.PI * 2);
                    ctx.fill();

                    if (isSelected || isHovered) {
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    }

                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;

                    ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                    ctx.font = '600 13px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(place.name, place.x, place.y - 20);
                });
            });
        }

        // === –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ç–æ—á–∫–∞–º–∏ ===
        function getPointAt(x, y) {
            for (const category in places) {
                for (let i = 0; i < places[category].length; i++) {
                    const place = places[category][i];
                    const dist = Math.sqrt((x - place.x) ** 2 + (y - place.y) ** 2);
                    if (dist < 15) {
                        return { category, index: i, place };
                    }
                }
            }
            return null;
        }

        function showInfoPanel(point) {
            const panel = document.getElementById('infoPanel');
            const place = point.place;

            let html = `<div class="info-title">${place.name}</div><div class="info-criteria">`;

            // –ö—Ä–∏—Ç–µ—Ä–∏–∏
            const categoryCriteria = criteria[point.category];
            categoryCriteria.forEach(criterion => {
                const value = place.ratings[criterion.id] || 0;
                const stars = '‚òÖ'.repeat(value) + '‚òÜ'.repeat(5 - value);
                html += `
                    <div class="info-criterion">
                        <span class="info-criterion-name">${criterion.label}</span>
                        <span class="info-criterion-value info-stars">${stars}</span>
                    </div>
                `;
            });

            html += '</div>';

            // –î–æ–ø –ø–æ–ª—è
            if (place.averageCheck) {
                html += `<div class="info-description">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${place.averageCheck} ‚ÇΩ</div>`;
            }
            if (place.description) {
                html += `<div class="info-description">${place.description}</div>`;
            }

            panel.innerHTML = html;
            panel.classList.add('show');
        }

        function hideInfoPanel() {
            document.getElementById('infoPanel').classList.remove('show');
        }

        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            draggedPoint = getPointAt(x, y);
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (draggedPoint) {
                draggedPoint.place.x = Math.max(20, Math.min(canvas.width - 20, x));
                draggedPoint.place.y = Math.max(20, Math.min(canvas.height - 20, y));
                drawMap();
            } else {
                const point = getPointAt(x, y);
                if (point) {
                    canvas.style.cursor = 'pointer';
                    hoveredPoint = point;
                    showInfoPanel(point);
                } else {
                    canvas.style.cursor = 'grab';
                    hoveredPoint = null;
                    hideInfoPanel();
                }
                drawMap();
            }
        }

        function handleMouseUp() {
            if (draggedPoint) {
                savePlaces();
            }
            draggedPoint = null;
        }

        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const point = getPointAt(x, y);
            if (point && !draggedPoint) {
                selectPlace(point.category, point.index);
            }
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            draggedPoint = getPointAt(x, y);
            if (draggedPoint) {
                showInfoPanel(draggedPoint);
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!draggedPoint) return;

            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            draggedPoint.place.x = Math.max(20, Math.min(canvas.width - 20, x));
            draggedPoint.place.y = Math.max(20, Math.min(canvas.height - 20, y));

            drawMap();
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (draggedPoint) {
                savePlaces();
            }
            draggedPoint = null;
        }

        // === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–º ===
        function buildRoute() {
            drawMap();
        }

        function clearRoute() {
            selectedPlaces.meet = null;
            selectedPlaces.talk = null;
            selectedPlaces.sex = null;
            renderPlacesLists();
            drawMap();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target.id === 'addModal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
