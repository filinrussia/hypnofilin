
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–∏–ª—å–¥–∏—è –ü—Ä–æ–¥–∞–∂</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <h1>
            <span class="title"><span>–ì–∏–ª—å–¥–∏—è</span><span>üí∞ –ü—Ä–æ–¥–∞–∂ üí∞</span></span>
        </h1>
        <div class="button-container">
            <button onclick="generateScenario()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button onclick="showRules()">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
            <button onclick="showPremiumPopup()" id="premium-btn">–ü—Ä–µ–º–∏—É–º</button>
        </div>
        <div id="scenario"></div>
    </div>
    <div id="popup" class="popup">
        <div id="popup-title" class="popup-title"></div>
        <div id="popup-content" class="popup-content"></div>
        <button onclick="closePopup()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="finish-popup" class="popup">
        <div id="finish-content">–û–±—Å—É–¥–∏ —Å –¥—Ä—É–∑—å—è–º–∏! –ö–∞–∫ –ø—Ä–æ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?</div>
        <button onclick="closeFinishPopup()">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë</button>
    </div>
    <div id="gallery-popup" class="gallery-popup">
        <div id="gallery-title" class="popup-title"></div>
        <div id="gallery-content" class="gallery-grid"></div>
        <button onclick="closeGalleryPopup()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        const traders = [
            { name: "–ë—Ä–æ–¥—è–≥–∞", desc: "–°—É–Ω–¥—É–∫ –Ω–∞ —Å–ø–∏–Ω–µ, —É–ª—ã–±–∫–∞ –¥–æ —É—à–µ–π!...", image: "https://hypnofilin.ru/games/gp/pictures/merchants/brod.jpg" },
            { name: "–õ–∞–≤–∫–∞", desc: "–ú–∞–≥–∏—è –≤ –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–µ!...", image: "https://hypnofilin.ru/games/gp/pictures/merchants/magelavk.jpg" },
            { name: "–ë–∞–∑–∞—Ä", desc: "–¢–æ—Ä–≥—É–π—Å—è, –∫–∞–∫ –±—É–¥—Ç–æ –æ—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç...", image: "https://hypnofilin.ru/games/gp/pictures/merchants/vost.jpg" },
            { name: "–§–µ—Ä–º–µ—Ä", desc: "–°–≤–µ–∂–∞–∫ —Å –≥—Ä—è–¥–∫–∏, —Ç–æ–ª—å–∫–æ –≤—á–µ—Ä–∞ —Å–æ–±—Ä–∞–ª!...", image: "https://hypnofilin.ru/games/gp/pictures/merchants/peasant.jpg" },
            { name: "–†—ã–Ω–æ–∫", desc: "–¢—Å—Å—Å... –£ –º–µ–Ω—è –µ—Å—Ç—å —Ç–æ, —á—Ç–æ —Ç–µ–±–µ...", image: "https://hypnofilin.ru/games/gp/pictures/merchants/blackmarket.jpg" }
        ];

        const techniques = [
            { name: "–°–∫–∏–¥–∫–∞", desc: "–ü–æ—á—Ç–∏ –¥–∞—Ä–æ–º? –ü–æ—á–µ–º—É –±—ã –∏ –Ω–µ—Ç!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/sale.jpg" },
            { name: "–°–µ–≥–æ–¥–Ω—è", desc: "–ó–∞–≤—Ç—Ä–∞ –±—É–¥–µ—Ç –ø–æ–∑–¥–Ω–æ!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/now.jpg" },
            { name: "–û—Ç–∑—ã–≤—ã", desc: "–í—Å–µ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ, –∞ –≤—ã?...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/thumbs-up.jpg" },
            { name: "–ü—Ä–æ–±–∞", desc: "–ü–æ–ø—Ä–æ–±—É–π ‚Äî –ø–æ—Ç–æ–º –∫—É–ø–∏—à—å!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/gift.jpg" },
            { name: "–ü–∞–∫–µ—Ç", desc: "–ë–æ–ª—å—à–µ ‚Äî –∑–Ω–∞—á–∏—Ç –≤—ã–≥–æ–¥–Ω–µ–µ!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/basket.jpg" },
            { name: "–î–µ—Ñ–∏—Ü–∏—Ç", desc: "–£—Å–ø–µ–π, –ø–æ–∫–∞ –Ω–µ —Ä–∞—Å–∫—É–ø–∏–ª–∏!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/deficit.jpg" },
            { name: "–ì–∞—Ä–∞–Ω—Ç–∏—è", desc: "–ù–∏–∫–∞–∫–æ–≥–æ —Ä–∏—Å–∫–∞!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/warranty.jpg" },
            { name: "–õ–µ–≥–µ–Ω–¥–∞", desc: "–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–æ–≤–∞—Ä ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/legend.jpg" },
            { name: "–†–µ–∑—É–ª—å—Ç–∞—Ç", desc: "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/result.jpg" },
            { name: "–≠–∫—Å–ø–µ—Ä—Ç", desc: "–ú—ã –∑–Ω–∞–µ–º –≤—Å—ë –æ–± —ç—Ç–æ–º!...", image: "https://hypnofilin.ru/games/gp/pictures/techniques/expert.jpg" }
        ];

        const values = [
            { name: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", desc: "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω–æ–µ!...", image: "https://hypnofilin.ru/games/gp/pictures/values/bezopasnost.jpg" },
            { name: "–°–≤–æ–±–æ–¥–∞", desc: "–ñ–∏–∑–Ω—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!...", image: "https://hypnofilin.ru/games/gp/pictures/values/svoboda.jpg" },
            { name: "–ü—Ä–µ—Å—Ç–∏–∂", desc: "–í—ã —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–æ–π–Ω—ã!...", image: "https://hypnofilin.ru/games/gp/pictures/values/status.jpg" },
            { name: "–°–µ–º—å—è", desc: "–°–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ ‚Äî —ç—Ç–æ –æ–Ω–∏!...", image: "https://hypnofilin.ru/games/gp/pictures/values/family.jpg" },
            { name: "–ó–¥–æ—Ä–æ–≤—å–µ", desc: "–ó–¥–æ—Ä–æ–≤—å–µ ‚Äî —ç—Ç–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ!...", image: "https://hypnofilin.ru/games/gp/pictures/values/health.jpg" },
            { name: "–í—ã–≥–æ–¥–∞", desc: "–ü–æ—á—ë–º –æ–ø—Ç–æ–º? –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏...", image: "https://hypnofilin.ru/games/gp/pictures/values/vigoda.jpg" },
            { name: "–í–ª–∞—Å—Ç—å", desc: "–ö—Ç–æ –∑–¥–µ—Å—å –≥–ª–∞–≤–Ω—ã–π?...", image: "https://hypnofilin.ru/games/gp/pictures/values/vlast.jpg" },
            { name: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", desc: "–í—Å—ë –∏–¥—ë—Ç –ø–æ –ø–ª–∞–Ω—É!...", image: "https://hypnofilin.ru/games/gp/pictures/values/iron.jpg" },
            { name: "–°–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å", desc: "–¢—ã –≤—ã–≥–ª—è–¥–∏—à—å –ø–æ—Ç—Ä—è—Å–∞—é—â–µ!...", image: "https://hypnofilin.ru/games/gp/pictures/values/sex.jpg" },
            { name: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", desc: "–ñ–∏–∑–Ω—å ‚Äî —ç—Ç–æ –ø—Ä–∞–∑–¥–Ω–∏–∫!...", image: "https://hypnofilin.ru/games/gp/pictures/values/razvlechenie.jpg" }
        ];

        const buyers = [
            { name: "–ë–∞—Ä–¥", desc: "–ú–µ–ª–æ–¥–∏—è –≤ –¥—É—à–µ, –∫–æ—à–µ–ª—ë–∫ –≤ –ø—ã–ª–∏!...", image: "https://hypnofilin.ru/games/gp/pictures/buyers/bard.jpg" },
            { name: "–í–æ–∏–Ω", desc: "–ú–µ—á ‚Äî –º–æ–π –ª—É—á—à–∏–π –¥—Ä—É–≥, –Ω–æ –∏...", image: "https://hypnofilin.ru/games/gp/pictures/buyers/warrior.jpg" },
            { name: "–ö—Ä–µ—Å—Ç—å—è–Ω–∏–Ω", desc: "–†–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥–æ, –Ω–æ –∏ –ø–æ–±–∞–ª–æ–≤–∞—Ç—å...", image: "https://hypnofilin.ru/games/gp/pictures/buyers/peasant.jpg" },
            { name: "–ú–∞–≥", desc: "–ú–æ—è –º–∞–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –∂–µ—Ä—Ç–≤...", image: "https://hypnofilin.ru/games/gp/pictures/buyers/mage.jpg" },
            { name: "–†–∞–∑–±–æ–π–Ω–∏–∫", desc: "–ó–∞—á–µ–º –ø–ª–∞—Ç–∏—Ç—å, –µ—Å–ª–∏ –º–æ–∂–Ω–æ...", image: "https://hypnofilin.ru/games/gp/pictures/buyers/rogue.jpg" }
        ];

        const needs = [
            { name: "–ë–æ–π—Ü—ã", desc: "–°–∏–ª—å–Ω—ã–µ –∏ –ø—Ä–µ–¥–∞–Ω–Ω—ã–µ –±–æ–π—Ü—ã...", image: "https://hypnofilin.ru/games/gp/pictures/needs/mercenary.jpg" },
            { name: "–ó–µ–ª—å—è", desc: "–ó–µ–ª—å—è ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/potion.jpg" },
            { name: "–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ", desc: "–ú–∞–≥–∏—è ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/spell.jpg" },
            { name: "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ", desc: "–û–±—ã—á–Ω—ã–π –º–µ—á –º–æ–∂–µ—Ç...", image: "https://hypnofilin.ru/games/gp/pictures/needs/enchant.jpg" },
            { name: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", desc: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Äî —ç—Ç–æ –∫–ª—é—á...", image: "https://hypnofilin.ru/games/gp/pictures/needs/information.jpg" },
            { name: "–£–¥–∞—Ä", desc: "–ù–æ–≤—ã–π –±–æ–µ–≤–æ–π –ø—Ä–∏—ë–º ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/practice.jpg" },
            { name: "–†–µ–º–æ–Ω—Ç", desc: "–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/repair.jpg" },
            { name: "–ù–∞–≤—ã–∫–∏", desc: "–°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/skill.jpg" },
            { name: "–û—Ç–¥—ã—Ö", desc: "–°–∏–ª—ã –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã...", image: "https://hypnofilin.ru/games/gp/pictures/needs/pillow.jpg" },
            { name: "–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ", desc: "–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ...", image: "https://hypnofilin.ru/games/gp/pictures/needs/equipment.jpg" }
        ];

        const motivations = [
            { name: "–ê–∫–∞–¥–µ–º–∏—è", desc: "–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –ê–∫–∞–¥–µ–º–∏—é ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/academy.jpg" },
            { name: "–ê–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å", desc: "–ö–æ–≥–¥–∞ –º–∏—Ä –Ω–∞ –≥—Ä–∞–Ω–∏, –∫–∞–∂–¥–∞—è...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/apocalypse.jpg" },
            { name: "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç", desc: "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/artefact.jpg" },
            { name: "–ì–∏–ª—å–¥–∏—è", desc: "–õ–∏–¥–µ—Ä—Å—Ç–≤–æ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/guild.jpg" },
            { name: "–ü—Ä–æ–∫–ª—è—Ç—å–µ", desc: "–ü—Ä–æ–∫–ª—è—Ç—å–µ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/curse.jpg" },
            { name: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞", desc: "–°–ø–∞—Å–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/princess.jpg" },
            { name: "–ü–æ—Ä—Ç–∞–ª", desc: "–ó–∞—Å—Ç—Ä—è—Ç—å –≤ —á—É–∂–æ–º –º–∏—Ä–µ ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/portal.jpg" },
            { name: "–ó–µ–º–ª—è", desc: "–ó–∞—â–∏—Ç–∞ —Ä–æ–¥–Ω–æ–π –∑–µ–º–ª–∏ ‚Äî —ç—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/homeland.jpg" },
            { name: "–ú–æ–Ω—Å—Ç—Ä", desc: "–ú–æ–Ω—Å—Ç—Ä ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/monster.jpg" },
            { name: "–¢–∞–π–Ω–∞", desc: "–¢–∞–π–Ω—ã ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ...", image: "https://hypnofilin.ru/games/gp/pictures/motivations/mystery.jpg" }
        ];

        let isPremiumUser = false;
        let currentTrader, currentTechnique, currentValue, currentPrice, currentBuyer, currentNeed, currentMotivation, currentBudget;

        function getDayNumber() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function getDailyFreeItems(fullArray, count = 3) {
            const dayNum = getDayNumber();
            const seededRandom = (seed) => {
                const x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            };
            const shuffled = [...fullArray].sort((a, b) => seededRandom(dayNum + fullArray.indexOf(a)) - seededRandom(dayNum + fullArray.indexOf(b)));
            return shuffled.slice(0, count);
        }

        const freeTraders = getDailyFreeItems(traders);
        const freeTechniques = getDailyFreeItems(techniques);
        const freeValues = getDailyFreeItems(values);
        const freeBuyers = getDailyFreeItems(buyers);
        const freeNeeds = getDailyFreeItems(needs);
        const freeMotivations = getDailyFreeItems(motivations);

        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function showPopup(title, desc, image) {
            const popup = document.getElementById("popup");
            const popupTitle = document.getElementById("popup-title");
            const popupContent = document.getElementById("popup-content");
            popupTitle.textContent = title;
            popupContent.innerHTML = image ? `<img src="${image}" alt="${title}" onerror="this.src='https://via.placeholder.com/150'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'"><br>${desc}` : desc;
            popup.style.display = "block";
        }

        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }

        function showGalleryPopup(category, allItems, freeItems, type) {
            const galleryPopup = document.getElementById("gallery-popup");
            const galleryTitle = document.getElementById("gallery-title");
            const galleryContent = document.getElementById("gallery-content");
            galleryTitle.textContent = `–í—ã–±–µ—Ä–∏—Ç–µ ${category}`;
            galleryContent.innerHTML = allItems.map(item => {
                const isFree = freeItems.some(freeItem => freeItem.name === item.name);
                const className = (!isPremiumUser && !isFree) ? 'grayscale' : '';
                return `
                    <div class="gallery-item">
                        <img src="${item.image}" alt="${item.name}" class="${className}" 
                             onerror="this.src='https://via.placeholder.com/100'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                             onclick="selectItem('${type}', '${item.name}')">
                        <div class="label">${item.name}</div>
                    </div>
                `;
            }).join('');
            galleryPopup.style.display = "block";
        }

        function closeGalleryPopup() {
            document.getElementById("gallery-popup").style.display = "none";
        }

        function selectItem(type, name) {
            if (!isPremiumUser) {
                const allItems = { trader: traders, technique: techniques, value: values, buyer: buyers, need: needs, motivation: motivations };
                const freeItems = { trader: freeTraders, technique: freeTechniques, value: freeValues, buyer: freeBuyers, need: freeNeeds, motivation: freeMotivations };
                const selectedItem = allItems[type].find(i => i.name === name);
                if (!freeItems[type].some(f => f.name === name)) {
                    closeGalleryPopup();
                    showPremiumPopup();
                    return;
                }
            }
            if (type === 'trader') {
                currentTrader = traders.find(t => t.name === name);
                document.getElementById('trader-tile').src = currentTrader.image;
                document.getElementById('trader-title').textContent = currentTrader.name;
            } else if (type === 'technique') {
                currentTechnique = techniques.find(t => t.name === name);
                document.getElementById('technique-tile').src = currentTechnique.image;
                document.getElementById('technique-title').textContent = currentTechnique.name;
            } else if (type === 'value') {
                currentValue = values.find(v => v.name === name);
                document.getElementById('value-tile').src = currentValue.image;
                document.getElementById('value-title').textContent = currentValue.name;
            } else if (type === 'buyer') {
                currentBuyer = buyers.find(b => b.name === name);
                document.getElementById('buyer-tile').src = currentBuyer.image;
                document.getElementById('buyer-title').textContent = currentBuyer.name;
            } else if (type === 'need') {
                currentNeed = needs.find(n => n.name === name);
                document.getElementById('need-tile').src = currentNeed.image;
                document.getElementById('need-title').textContent = currentNeed.name;
            } else if (type === 'motivation') {
                currentMotivation = motivations.find(m => m.name === name);
                document.getElementById('motivation-tile').src = currentMotivation.image;
                document.getElementById('motivation-title').textContent = currentMotivation.name;
            }
            closeGalleryPopup();
        }

        function showRules() {
            const rulesText = `
                –°—É—Ç—å –∏–≥—Ä—ã: –≤—ã ‚Äî —Ç–æ—Ä–≥–æ–≤–µ—Ü –∏–∑ –ì–∏–ª—å–¥–∏–∏ –ü—Ä–æ–¥–∞–∂, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω —É–±–µ–¥–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏—ë–º—ã, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–π—Ç–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –±—é–¥–∂–µ—Ç –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –∑–∞–∫–ª—é—á–∏—Ç—å —Å–¥–µ–ª–∫—É!<br><br>
                1. –ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–∞—è –∏–≥—Ä–∞" –∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫. –í –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –ø–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞. –í –ø—Ä–µ–º–∏—É–º-–≤–µ—Ä—Å–∏–∏ ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∏ –≤—ã–±–æ—Ä.<br>
                2. –ò–∑—É—á–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏.<br>
                3. –£—á—Ç–∏—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –∏ –±—é–¥–∂–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è ‚Äî —Å–¥–µ–ª–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—é–¥–∂–µ—Ç ‚â• —Ü–µ–Ω—ã.<br>
                4. –ù–∞—á–Ω–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤–ª—é –∏ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏.<br>
                5. –û–±—Å—É–¥–∏—Ç–µ —Å –¥—Ä—É–∑—å—è–º–∏, –∫–∞–∫ –ø—Ä–æ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏!
            `;
            showPopup("–ö–∞–∫ –∏–≥—Ä–∞—Ç—å", rulesText);
        }

        function showPremiumPopup() {
            const premiumText = `
                –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –≤—Å—ë: —Ç–æ—Ä–≥–æ–≤—Ü—ã, –ø—Ä–∏—ë–º—ã, —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, –º–æ—Ç–∏–≤–∞—Ü–∏–∏!<br><br>
                –°–æ–±–µ—Ä–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–¥ —Å–≤–æ—é –∑–∞–¥–∞—á—É.<br><br>
                <button onclick="subscribe('month')">139‚ÇΩ/–º–µ—Å—è—Ü</button>
                <button onclick="subscribe('year')">995‚ÇΩ/–≥–æ–¥</button>
            `;
            showPopup("–ü—Ä–µ–º–∏—É–º", premiumText);
        }

        function subscribe() {
            isPremiumUser = true;
            alert("–ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! (–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)");
            closePopup();
            generateScenario();
        }

        function closeFinishPopup() {
            document.getElementById("finish-popup").style.display = "none";
        }

        function generateScenario() {
            currentTrader = getRandomElement(isPremiumUser ? traders : freeTraders);
            currentTechnique = getRandomElement(isPremiumUser ? techniques : freeTechniques);
            currentValue = getRandomElement(isPremiumUser ? values : freeValues);
            currentPrice = getRandomNumber(0, 1);
            currentBuyer = getRandomElement(isPremiumUser ? buyers : freeBuyers);
            currentNeed = getRandomElement(isPremiumUser ? needs : freeNeeds);
            currentMotivation = getRandomElement(isPremiumUser ? motivations : freeMotivations);
            currentBudget = getRandomNumber(0, 1);

            const scenarioText = `
                <div class="divider"></div>
                <div class="tiles-container">
                    <!-- –õ–µ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü -->
                    <div class="tile-block">
                        <div id="price-title" class="price-budget-btn">–¶–ï–ù–ê ${currentPrice}</div>
                    </div>
                    <div class="tile-block">
                        <div id="budget-title" class="price-budget-btn">–ë–Æ–î–ñ–ï–¢ ${currentBudget}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="trader-tile" src="${currentTrader.image}" alt="${currentTrader.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentTrader.name, currentTrader.desc, currentTrader.image)">
                            <div class="tile-label">–¢–û–†–ì–û–í–ï–¶</div>
                        </div>
                        <div id="trader-title" class="tile-title" onclick="showGalleryPopup('—Ç–æ—Ä–≥–æ–≤—Ü–∞', traders, freeTraders, 'trader')">${currentTrader.name}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="buyer-tile" src="${currentBuyer.image}" alt="${currentBuyer.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentBuyer.name, currentBuyer.desc, currentBuyer.image)">
                            <div class="tile-label">–ü–û–ö–£–ü–ê–¢–ï–õ–¨</div>
                        </div>
                        <div id="buyer-title" class="tile-title" onclick="showGalleryPopup('–ø–æ–∫—É–ø–∞—Ç–µ–ª—è', buyers, freeBuyers, 'buyer')">${currentBuyer.name}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="technique-tile" src="${currentTechnique.image}" alt="${currentTechnique.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentTechnique.name, currentTechnique.desc, currentTechnique.image)">
                            <div class="tile-label">–ü–†–ò–Å–ú</div>
                        </div>
                        <div id="technique-title" class="tile-title" onclick="showGalleryPopup('–ø—Ä–∏—ë–º', techniques, freeTechniques, 'technique')">${currentTechnique.name}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="need-tile" src="${currentNeed.image}" alt="${currentNeed.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentNeed.name, currentNeed.desc, currentNeed.image)">
                            <div class="tile-label">–ü–û–¢–†–ï–ë–ù–û–°–¢–¨</div>
                        </div>
                        <div id="need-title" class="tile-title" onclick="showGalleryPopup('–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å', needs, freeNeeds, 'need')">${currentNeed.name}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="value-tile" src="${currentValue.image}" alt="${currentValue.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentValue.name, currentValue.desc, currentValue.image)">
                            <div class="tile-label">–¶–ï–ù–ù–û–°–¢–¨</div>
                        </div>
                        <div id="value-title" class="tile-title" onclick="showGalleryPopup('—Ü–µ–Ω–Ω–æ—Å—Ç—å', values, freeValues, 'value')">${currentValue.name}</div>
                    </div>
                    <div class="tile-block">
                        <div class="tile">
                            <img id="motivation-tile" src="${currentMotivation.image}" alt="${currentMotivation.name}" 
                                 onerror="this.src='https://via.placeholder.com/160'; this.alt='–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å'" 
                                 onclick="showPopup(currentMotivation.name, currentMotivation.desc, currentMotivation.image)">
                            <div class="tile-label">–ú–û–¢–ò–í–ê–¶–ò–Ø</div>
                        </div>
                        <div id="motivation-title" class="tile-title" onclick="showGalleryPopup('–º–æ—Ç–∏–≤–∞—Ü–∏—é', motivations, freeMotivations, 'motivation')">${currentMotivation.name}</div>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="button-container">
                    <button onclick="generateScenario()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button onclick="showRules()">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
                    <button onclick="showPremiumPopup()" id="premium-btn">–ü—Ä–µ–º–∏—É–º</button>
                </div>
            `;

            const scenarioElement = document.getElementById("scenario");
            scenarioElement.style.display = "block";
            scenarioElement.innerHTML = scenarioText;
            document.querySelector("#game-container > .button-container").style.display = "none";
        }

        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
    </script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93437c632b44ad82',t:'MTc0NTMwNzc2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
